Name[0]}${member.lastName[0]}</span>
                        </div>
                        <div class="flex items-center gap-3">
                            <span class="font-medium text-gray-900">${member.firstName} ${member.lastName}</span>
                            ${status ? `<span class="inline-flex items-center px-2 py-1 rounded text-xs font-medium ${status === 'attending' ? 'bg-green-100 text-green-700' : 'bg-red-100 text-red-700'}">
                                ${status === 'attending' ? '✓ Attending' : '✗ Not Attending'}
                            </span>` : '<span class="text-gray-500 text-sm">No response</span>'}
                        </div>
                    </div>
                    <div class="flex gap-2">
                        <button onclick="checkIn('${member.firstName}', '${member.lastName}', 'attending')" 
                                class="px-4 py-2 rounded font-medium text-sm transition-colors ${status === 'attending' ? 'bg-green-500 text-white' : 'bg-gray-100 text-gray-700 hover:bg-gray-200'}">In</button>
                        <button onclick="checkIn('${member.firstName}', '${member.lastName}', 'not_attending')" 
                                class="px-4 py-2 rounded font-medium text-sm transition-colors ${status === 'not_attending' ? 'bg-red-500 text-white' : 'bg-gray-100 text-gray-700 hover:bg-gray-200'}">Out</button>
                    </div>
                </div>`;
            }).join('');
        }

        function renderRoster() {
            document.getElementById('roster-list').innerHTML = roster.map(member => `
                <div class="flex items-center justify-between p-4 border rounded-lg hover:bg-gray-50 transition-colors">
                    <div class="flex items-center gap-4">
                        <div class="w-12 h-12 bg-gray-100 rounded-full flex items-center justify-center">
                            <span class="font-bold text-gray-600 text-sm">${member.firstName[0]}${member.lastName[0]}</span>
                        </div>
                        <div>
                            <h3 class="font-semibold text-gray-900">${member.firstName} ${member.lastName}</h3>
                        </div>
                    </div>
                    <div class="text-right">
                        <div class="text-sm text-gray-600">Games Played</div>
                        <div class="font-bold text-gray-900">${member.gamesPlayed || 0}</div>
                    </div>
                </div>
            `).join('');
        }

        function renderSchedule() {
            document.getElementById('schedule-list').innerHTML = games.map(game => `
                <div class="border rounded-lg p-4 ${game.isActive ? 'border-blue-500 bg-blue-50' : ''}">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-bold">vs ${game.opponent}</h3>
                            <p class="text-gray-600">${formatDate(game.date)} • ${formatTime(game.time)}</p>
                            <p class="text-gray-600">${game.location}</p>
                        </div>
                        <div class="text-right">
                            <span class="badge ${game.homeAway === 'Home' ? 'badge-success' : 'badge-warning'}">${game.homeAway}</span>
                            ${game.isActive ? '<div class="text-sm text-blue-600 font-medium mt-1">Active Game</div>' : ''}
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function renderAdmin() {
            // Admin stats
            const attending = attendees.filter(a => a.status === 'attending').length;
            const notAttending = attendees.filter(a => a.status === 'not_attending').length;
            const gameStatus = attending >= 10 ? 'Game confirmed' : 'Need more players';

            document.getElementById('admin-attending').textContent = attending;
            document.getElementById('admin-not-attending').textContent = notAttending;
            document.getElementById('admin-status').textContent = gameStatus;

            // Admin attendees
            document.getElementById('admin-attendees').innerHTML = attendees.length ?
                attendees.map(attendee => `
                    <div class="flex items-center justify-between p-3 border rounded-lg">
                        <div>
                            <span class="font-medium">${attendee.firstName} ${attendee.lastName}</span>
                            <span class="badge ml-2 ${attendee.status === 'attending' ? 'badge-success' : 'badge-danger'}">
                                ${attendee.status === 'attending' ? 'Attending' : 'Not Attending'}
                            </span>
                        </div>
                        <button onclick="clearAttendee('${attendee.id}')" class="btn-danger">Clear</button>
                    </div>
                `).join('') : '<p class="text-gray-600">No responses yet</p>';

            // Admin games
            document.getElementById('admin-games').innerHTML = games.map(game => `
                <div class="flex items-center justify-between p-3 border rounded-lg ${game.isActive ? 'border-blue-500 bg-blue-50' : ''}">
                    <div>
                        <span class="font-medium">vs ${game.opponent}</span>
                        <span class="text-gray-600 ml-2">${formatDate(game.date)} • ${formatTime(game.time)}</span>
                    </div>
                    ${game.isActive ? 
                        '<span class="badge badge-success">Active</span>' : 
                        `<button onclick="setActiveGame('${game.id}')" class="btn-primary">Set Active</button>`
                    }
                </div>
            `).join('');
        }

        // Helper functions
        function formatDate(dateString) {
            try {
                // Parse date as local time to avoid timezone shifting
                const parts = dateString.split('/');
                if (parts.length === 3) {
                    // Create date in local timezone (month is 0-indexed)
                    const date = new Date(parts[2], parts[0] - 1, parts[1]);
                    
                    // Check if date is valid
                    if (isNaN(date.getTime())) {
                        return dateString; // Return original if invalid
                    }
                    
                    return date.toLocaleDateString('en-US', {
                        weekday: 'short',
                        month: 'short',
                        day: 'numeric',
                        timeZone: 'America/Los_Angeles'
                    });
                }
                
                // Try ISO format or other standard formats
                const date = new Date(dateString);
                if (isNaN(date.getTime())) {
                    return dateString; // Return original if invalid
                }
                
                return date.toLocaleDateString('en-US', {
                    weekday: 'short',
                    month: 'short',
                    day: 'numeric',
                    timeZone: 'America/Los_Angeles'
                });
            } catch (error) {
                console.error('Date formatting error:', error, dateString);
                return dateString; // Return original if parsing fails
            }
        }

        function formatTime(timeString) {
            try {
                // If timeString is already formatted (like "7:10 PM"), return as is
                if (timeString && (timeString.includes('AM') || timeString.includes('PM'))) {
                    return timeString;
                }
                
                // Handle empty or undefined timeString
                if (!timeString) {
                    return '';
                }
                
                // Try multiple parsing approaches for better mobile compatibility
                let date;
                
                // Try ISO format first (more reliable on mobile)
                if (timeString.includes(':')) {
                    const [hours, minutes] = timeString.split(':');
                    date = new Date();
                    date.setHours(parseInt(hours, 10), parseInt(minutes, 10), 0, 0);
                } else {
                    // Fallback to string parsing
                    date = new Date(`2000-01-01T${timeString}:00`);
                }
                
                // Check if date is valid
                if (isNaN(date.getTime())) {
                    return timeString; // Return original if invalid
                }
                
                return date.toLocaleTimeString('en-US', {
                    hour: 'numeric',
                    minute: '2-digit',
                    hour12: true,
                    timeZone: 'America/Los_Angeles'
                });
            } catch (error) {
                console.error('Time formatting error:', error, timeString);
                return timeString; // Return original if parsing fails
            }
        }

        async function loadPageData() {
            if (currentPage === 'home' || currentPage === 'admin') {
                await Promise.all([loadRoster(), loadAttendees(), loadGames()]);
            } else if (currentPage === 'roster') {
                await loadRoster();
            } else if (currentPage === 'schedule') {
                await loadGames();
            }
            updateDisplay();
        }

        async function loadAdminData() {
            await Promise.all([loadRoster(), loadAttendees(), loadGames()]);
            renderAdmin();
        }

        // Initialize app
        document.addEventListener('DOMContentLoaded', async () => {
            initFirebase();
            await loadPageData();
            showPage('home');
        });
    </script>
</body>
</html>
